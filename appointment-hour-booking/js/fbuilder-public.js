(fbuilderjQuery="undefined"!=typeof fbuilderjQuery?fbuilderjQuery:jQuery)(function(){!function(e){e.extend({stringifyXX:function t(i){var a=function(e){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?e.replace(t,function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}):e},s=typeof i;if("object"!=s||null===i)return"string"==s&&(i='"'+i+'"'),String(i);var r,n,l=[],o=i&&i.constructor==Array;for(r in i)"function"!=(s=typeof(n=i[r]))&&("string"==s?n='"'+a(n)+'"':"object"==s&&null!==n&&(n=e.stringifyXX(n)),l.push((o?"":'"'+r+'":')+String(n)));return(o?"[":"{")+String(l)+(o?"]":"}")}})}(fbuilderjQuery)}),fbuilderjQuery="undefined"!=typeof fbuilderjQuery?fbuilderjQuery:jQuery,function(e){"function"==typeof define&&define.amd?define(["fbuilderjQuery"],e):"object"==typeof module&&module.exports?module.exports=e(require("fbuilderjQuery")):e(fbuilderjQuery)}(function(e){e.extend(e.fn,{validate:function(t){if(!this.length){t&&t.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing.");return}var i=e.data(this[0],"validator");return i||(this.attr("novalidate","novalidate"),i=new e.validator(t,this[0]),e.data(this[0],"validator",i),i.settings.onsubmit&&(this.on("click.validate",":submit",function(t){i.submitButton=t.currentTarget,e(this).hasClass("cancel")&&(i.cancelSubmit=!0),void 0!==e(this).attr("formnovalidate")&&(i.cancelSubmit=!0)}),this.on("submit.validate",function(t){function a(){var a,s;return i.submitButton&&(i.settings.submitHandler||i.formSubmitted)&&(a=e("<input type='hidden'/>").attr("name",i.submitButton.name).val(e(i.submitButton).val()).appendTo(i.currentForm)),!i.settings.submitHandler||(s=i.settings.submitHandler.call(i,i.currentForm,t),a&&a.remove(),void 0!==s&&s)}return(i.settings.debug&&t.preventDefault(),i.cancelSubmit)?(i.cancelSubmit=!1,a()):i.form()?i.pendingRequest?(i.formSubmitted=!0,!1):a():(i.focusInvalid(),!1)}))),i},valid:function(){var t,i,a;return e(this[0]).is("form")?t=this.validate().form():(a=[],t=!0,i=e(this[0].form).validate(),this.each(function(){(t=i.element(this)&&t)||(a=a.concat(i.errorList))}),i.errorList=a),t},rules:function(t,i){var a,s,r,n,l,o,d=this[0];if(null!=d){if(!d.form&&d.hasAttribute("contenteditable")&&(d.form=this.closest("form")[0],d.name=this.attr("name")),null!=d.form){if(t)switch(s=(a=e.data(d.form,"validator").settings).rules,r=e.validator.staticRules(d),t){case"add":e.extend(r,e.validator.normalizeRule(i)),delete r.messages,s[d.name]=r,i.messages&&(a.messages[d.name]=e.extend(a.messages[d.name],i.messages));break;case"remove":if(!i)return delete s[d.name],r;return o={},e.each(i.split(/\s/),function(e,t){o[t]=r[t],delete r[t]}),o}return(n=e.validator.normalizeRules(e.extend({},e.validator.classRules(d),e.validator.attributeRules(d),e.validator.dataRules(d),e.validator.staticRules(d)),d)).required&&(l=n.required,delete n.required,n=e.extend({required:l},n)),n.remote&&(l=n.remote,delete n.remote,n=e.extend(n,{remote:l})),n}}}}),e.extend(e.expr.pseudos||e.expr[":"],{blank:function(t){return!e.trim(""+e(t).val())},filled:function(t){var i=e(t).val();return null!==i&&!!e.trim(""+i)},unchecked:function(t){return!e(t).prop("checked")}}),e.validator=function(t,i){this.settings=e.extend(!0,{},e.validator.defaults,t),this.currentForm=i,this.init()},e.validator.format=function(t,i){return 1===arguments.length?function(){var i=e.makeArray(arguments);return i.unshift(t),e.validator.format.apply(this,i)}:(void 0===i||(arguments.length>2&&i.constructor!==Array&&(i=e.makeArray(arguments).slice(1)),i.constructor!==Array&&(i=[i]),e.each(i,function(e,i){t=t.replace(RegExp("\\{"+e+"\\}","g"),function(){return i})})),t)},e.extend(e.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"cpefb_error",pendingClass:"pending",validClass:"valid",errorElement:"label",focusCleanup:!1,focusInvalid:!0,errorContainer:e([]),errorLabelContainer:e([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(e){this.lastActive=e,this.settings.focusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,e,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(e)))},onfocusout:function(e){!this.checkable(e)&&(e.name in this.submitted||!this.optional(e))&&this.element(e)},onkeyup:function(t,i){var a=[16,17,18,20,35,36,37,38,39,40,45,144,225];(9!==i.which||""!==this.elementValue(t))&&-1===e.inArray(i.keyCode,a)&&(t.name in this.submitted||t.name in this.invalid)&&this.element(t)},onclick:function(e){e.name in this.submitted?this.element(e):e.parentNode.name in this.submitted&&this.element(e.parentNode)},highlight:function(t,i,a){"radio"===t.type?this.findByName(t.name).addClass(i).removeClass(a):e(t).addClass(i).removeClass(a)},unhighlight:function(t,i,a){"radio"===t.type?this.findByName(t.name).removeClass(i).addClass(a):e(t).removeClass(i).addClass(a)}},setDefaults:function(t){e.extend(e.validator.defaults,t)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",equalTo:"Please enter the same value again.",maxlength:e.validator.format("Please enter no more than {0} characters."),minlength:e.validator.format("Please enter at least {0} characters."),rangelength:e.validator.format("Please enter a value between {0} and {1} characters long."),range:e.validator.format("Please enter a value between {0} and {1}."),max:e.validator.format("Please enter a value less than or equal to {0}."),min:e.validator.format("Please enter a value greater than or equal to {0}."),step:e.validator.format("Please enter a multiple of {0}.")},autoCreateRanges:!1,prototype:{init:function(){this.labelContainer=e(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||e(this.currentForm),this.containers=e(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var t,i=this.groups={};function a(t){!this.form&&this.hasAttribute("contenteditable")&&(this.form=e(this).closest("form")[0],this.name=e(this).attr("name"));var i=e.data(this.form,"validator"),a="on"+t.type.replace(/^validate/,""),s=i.settings;s[a]&&!e(this).is(s.ignore)&&s[a].call(i,this,t)}e.each(this.settings.groups,function(t,a){"string"==typeof a&&(a=a.split(/\s/)),e.each(a,function(e,a){i[a]=t})}),t=this.settings.rules,e.each(t,function(i,a){t[i]=e.validator.normalizeRule(a)}),e(this.currentForm).on("focusin.validate focusout.validate keyup.validate",":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'], [type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox'], [contenteditable], [type='button']",a).on("click.validate","select, option, [type='radio'], [type='checkbox']",a),this.settings.invalidHandler&&e(this.currentForm).on("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),e.extend(this.submitted,this.errorMap),this.invalid=e.extend({},this.errorMap),this.valid()||e(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var e=0,t=this.currentElements=this.elements();t[e];e++)this.check(t[e]);return this.valid()},element:function(t){var i,a,s=this.clean(t),r=this.validationTargetFor(s),n=this,l=!0;return void 0===r?delete this.invalid[s.name]:(this.prepareElement(r),this.currentElements=e(r),(a=this.groups[r.name])&&e.each(this.groups,function(e,t){t===a&&e!==r.name&&(s=n.validationTargetFor(n.clean(n.findByName(e))))&&s.name in n.invalid&&(n.currentElements.push(s),l=n.check(s)&&l)}),i=!1!==this.check(r),l=l&&i,i?this.invalid[r.name]=!1:this.invalid[r.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),e(t).attr("aria-invalid",!i)),l},showErrors:function(t){if(t){var i=this;e.extend(this.errorMap,t),this.errorList=e.map(this.errorMap,function(e,t){return{message:e,element:i.findByName(t)[0]}}),this.successList=e.grep(this.successList,function(e){return!(e.name in t)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){e.fn.resetForm&&e(this.currentForm).resetForm(),this.invalid={},this.submitted={},this.prepareForm(),this.hideErrors();var t=this.elements().removeData("previousValue").removeAttr("aria-invalid");this.resetElements(t)},resetElements:function(e){var t;if(this.settings.unhighlight)for(t=0;e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,""),this.findByName(e[t].name).removeClass(this.settings.validClass);else e.removeClass(this.settings.errorClass).removeClass(this.settings.validClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var t,i=0;for(t in e)void 0!==e[t]&&null!==e[t]&&!1!==e[t]&&i++;return i},hideErrors:function(){this.hideThese(this.toHide)},hideThese:function(e){this.addWrapper(e).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{e(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(t){}},findLastActive:function(){var t=this.lastActive;return t&&1===e.grep(this.errorList,function(e){return e.element.name===t.name}).length&&t},elements:function(){var t=this,i={};return e(this.currentForm).find("input, select, textarea, [contenteditable]").not(":submit, :reset, :image, :disabled").not(this.settings.ignore).filter(function(){var a=this.name||e(this).attr("name");return!a&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.hasAttribute("contenteditable")&&(this.form=e(this).closest("form")[0],this.name=a),!(a in i)&&!!t.objectLength(e(this).rules())&&(i[a]=!0,!0)})},clean:function(t){return e(t)[0]},errors:function(){var t=this.settings.errorClass.split(" ").join(".");return e(this.settings.errorElement+"."+t,this.errorContext)},resetInternals:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=e([]),this.toHide=e([])},reset:function(){this.resetInternals(),this.currentElements=e([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(e){this.reset(),this.toHide=this.errorsFor(e)},elementValue:function(t){var i,a,s=e(t),r=t.type;return"radio"===r||"checkbox"===r?this.findByName(t.name).filter(":checked").val():"number"===r&&void 0!==t.validity?t.validity.badInput?"NaN":s.val():(i=t.hasAttribute("contenteditable")?s.text():s.val(),"file"===r)?"C:\\fakepath\\"===i.substr(0,12)?i.substr(12):(a=i.lastIndexOf("/"))>=0||(a=i.lastIndexOf("\\"))>=0?i.substr(a+1):i:"string"==typeof i?i.replace(/\r/g,""):i},check:function(t){t=this.validationTargetFor(this.clean(t));var i,a,s,r,n=e(t).rules(),l=e.map(n,function(e,t){return t}).length,o=!1,d=this.elementValue(t);if("function"==typeof n.normalizer?r=n.normalizer:"function"==typeof this.settings.normalizer&&(r=this.settings.normalizer),r){if("string"!=typeof(d=r.call(t,d)))throw TypeError("The normalizer should return a string value.");delete n.normalizer}for(a in n){s={method:a,parameters:n[a]};try{if(i=e.validator.methods[a].call(this,d,t,s.parameters),"dependency-mismatch"===i&&1===l){o=!0;continue}if(o=!1,"pending"===i){this.toHide=this.toHide.not(this.errorsFor(t));return}if(!i)return this.formatAndAdd(t,s),!1}catch(c){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+t.id+", check the '"+s.method+"' method.",c),c instanceof TypeError&&(c.message+=".  Exception occurred when checking element "+t.id+", check the '"+s.method+"' method."),c}}if(!o)return this.objectLength(n)&&this.successList.push(t),!0},customDataMessage:function(t,i){return e(t).data("msg"+i.charAt(0).toUpperCase()+i.substring(1).toLowerCase())||e(t).data("msg")},customMessage:function(e,t){var i=this.settings.messages[e];return i&&(i.constructor===String?i:i[t])},findDefined:function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},defaultMessage:function(t,i){"string"==typeof i&&(i={method:i});var a=this.findDefined(this.customMessage(t.name,i.method),this.customDataMessage(t,i.method),!this.settings.ignoreTitle&&t.title||void 0,e.validator.messages[i.method],"<strong>Warning: No message defined for "+t.name+"</strong>"),s=/\$?\{(\d+)\}/g;return"function"==typeof a?a=a.call(this,i.parameters,t):s.test(a)&&(a=e.validator.format(a.replace(s,"{$1}"),i.parameters)),a},formatAndAdd:function(e,t){var i=this.defaultMessage(e,t);this.errorList.push({message:i,element:e,method:t.method}),this.errorMap[e.name]=i,this.submitted[e.name]=i},addWrapper:function(e){return this.settings.wrapper&&(e=e.add(e.parent(this.settings.wrapper))),e},defaultShowErrors:function(){var e,t,i;for(e=0;this.errorList[e];e++)i=this.errorList[e],this.settings.highlight&&this.settings.highlight.call(this,i.element,this.settings.errorClass,this.settings.validClass),this.showLabel(i.element,i.message);if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(e=0;this.successList[e];e++)this.showLabel(this.successList[e]);if(this.settings.unhighlight)for(e=0,t=this.validElements();t[e];e++)this.settings.unhighlight.call(this,t[e],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return e(this.errorList).map(function(){return this.element})},showLabel:function(t,i){var a,s,r,n,l=this.errorsFor(t),o=this.idOrName(t),d=e(t).attr("aria-describedby");l.length?(l.removeClass(this.settings.validClass).addClass(this.settings.errorClass),l.html(i)):(a=l=e("<"+this.settings.errorElement+">").attr("id",o+"-error").addClass(this.settings.errorClass).html(i||""),this.settings.wrapper&&(a=l.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.length?this.labelContainer.append(a):this.settings.errorPlacement?this.settings.errorPlacement.call(this,a,e(t)):a.insertAfter(t),l.is("label")?l.attr("for",o):0===l.parents("label[for='"+this.escapeCssMeta(o)+"']").length&&(r=l.attr("id"),d?d.match(RegExp("\\b"+this.escapeCssMeta(r)+"\\b"))||(d+=" "+r):d=r,e(t).attr("aria-describedby",d),(s=this.groups[t.name])&&(n=this,e.each(n.groups,function(t,i){i===s&&e("[name='"+n.escapeCssMeta(t)+"']",n.currentForm).attr("aria-describedby",l.attr("id"))})))),!i&&this.settings.success&&(l.text(""),"string"==typeof this.settings.success?l.addClass(this.settings.success):this.settings.success(l,t)),this.toShow=this.toShow.add(l)},errorsFor:function(t){var i=this.escapeCssMeta(this.idOrName(t)),a=e(t).attr("aria-describedby"),s="label[for='"+i+"'], label[for='"+i+"'] *";return a&&(s=s+", #"+this.escapeCssMeta(a).replace(/\s+/g,", #")),this.errors().filter(s)},escapeCssMeta:function(e){return e.replace(/([\\!"#$%&'()*+,./:;<=>?@\[\]^`{|}~])/g,"\\$1")},idOrName:function(e){return this.groups[e.name]||(this.checkable(e)?e.name:e.id||e.name)},validationTargetFor:function(t){return this.checkable(t)&&(t=this.findByName(t.name)),e(t).not(this.settings.ignore)[0]},checkable:function(e){return/radio|checkbox/i.test(e.type)},findByName:function(t){return e(this.currentForm).find("[name='"+this.escapeCssMeta(t)+"']")},getLength:function(t,i){switch(i.nodeName.toLowerCase()){case"select":return e("option:selected",i).length;case"input":if(this.checkable(i))return this.findByName(i.name).filter(":checked").length}return t.length},depend:function(e,t){return!this.dependTypes[typeof e]||this.dependTypes[typeof e](e,t)},dependTypes:{boolean:function(e){return e},string:function(t,i){return!!e(t,i.form).length},function:function(e,t){return e(t)}},optional:function(t){var i=this.elementValue(t);return!e.validator.methods.required.call(this,i,t)&&"dependency-mismatch"},startRequest:function(t){this.pending[t.name]||(this.pendingRequest++,e(t).addClass(this.settings.pendingClass),this.pending[t.name]=!0)},stopRequest:function(t,i){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[t.name],e(t).removeClass(this.settings.pendingClass),i&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(e(this.currentForm).submit(),this.submitButton&&e("input:hidden[name='"+this.submitButton.name+"']",this.currentForm).remove(),this.formSubmitted=!1):!i&&0===this.pendingRequest&&this.formSubmitted&&(e(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(t,i){return i="string"==typeof i&&i||"remote",e.data(t,"previousValue")||e.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,{method:i})})},destroy:function(){this.resetForm(),e(this.currentForm).off(".validate").removeData("validator").find(".validate-equalTo-blur").off(".validate-equalTo").removeClass("validate-equalTo-blur")}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(t,i){t.constructor===String?this.classRuleSettings[t]=i:e.extend(this.classRuleSettings,t)},classRules:function(t){var i={},a=e(t).attr("class");return a&&e.each(a.split(" "),function(){this in e.validator.classRuleSettings&&e.extend(i,e.validator.classRuleSettings[this])}),i},normalizeAttributeRule:function(e,t,i,a){/min|max|step/.test(i)&&(null===t||/number|range|text/.test(t))&&(/^\s*$/.test(a)||(a=Number(a)),isNaN(a)&&(a=void 0)),a||0===a?e[i]=a:t===i&&"range"!==t&&(e[i]=!0)},attributeRules:function(t){var i,a,s={},r=e(t),n=t.getAttribute("type");for(i in e.validator.methods)"required"===i?(""===(a=t.getAttribute(i))&&(a=!0),a=!!a):a=r.attr(i),this.normalizeAttributeRule(s,n,i,a);return s.maxlength&&/-1|2147483647|524288/.test(s.maxlength)&&delete s.maxlength,s},dataRules:function(t){var i,a,s={},r=e(t),n=t.getAttribute("type");for(i in e.validator.methods)a=r.data("rule"+i.charAt(0).toUpperCase()+i.substring(1).toLowerCase()),this.normalizeAttributeRule(s,n,i,a);return s},staticRules:function(t){var i={},a=e.data(t.form,"validator");return a.settings.rules&&(i=e.validator.normalizeRule(a.settings.rules[t.name])||{}),i},normalizeRules:function(t,i){return e.each(t,function(a,s){if(!1===s){delete t[a];return}if(s.param||s.depends){var r=!0;switch(typeof s.depends){case"string":r=!!e(s.depends,i.form).length;break;case"function":r=s.depends.call(i,i)}r?t[a]=void 0===s.param||s.param:(e.data(i.form,"validator").resetElements(e(i)),delete t[a])}}),e.each(t,function(a,s){t[a]=e.isFunction(s)&&"normalizer"!==a?s(i):s}),e.each(["minlength","maxlength"],function(){t[this]&&(t[this]=Number(t[this]))}),e.each(["rangelength","range"],function(){var i;t[this]&&(e.isArray(t[this])?t[this]=[Number(t[this][0]),Number(t[this][1])]:"string"==typeof t[this]&&(i=t[this].replace(/[\[\]]/g,"").split(/[\s,]+/),t[this]=[Number(i[0]),Number(i[1])]))}),e.validator.autoCreateRanges&&(null!=t.min&&null!=t.max&&(t.range=[t.min,t.max],delete t.min,delete t.max),null!=t.minlength&&null!=t.maxlength&&(t.rangelength=[t.minlength,t.maxlength],delete t.minlength,delete t.maxlength)),t},normalizeRule:function(t){if("string"==typeof t){var i={};e.each(t.split(/\s/),function(){i[this]=!0}),t=i}return t},addMethod:function(t,i,a){e.validator.methods[t]=i,e.validator.messages[t]=void 0!==a?a:e.validator.messages[t],i.length<3&&e.validator.addClassRules(t,e.validator.normalizeRule(t))},methods:{required:function(t,i,a){if(!this.depend(a,i))return"dependency-mismatch";if("select"===i.nodeName.toLowerCase()){var s=e(i).val();return s&&s.length>0}return this.checkable(i)?this.getLength(t,i)>0:t.length>0},email:function(e,t){return this.optional(t)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},url:function(e,t){return this.optional(t)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)},date:function(e,t){return this.optional(t)||!/Invalid|NaN/.test(new Date(e).toString())},dateISO:function(e,t){return this.optional(t)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(e)},number:function(e,t){return this.optional(t)||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e,t){return this.optional(t)||/^\d+$/.test(e)},minlength:function(t,i,a){var s=e.isArray(t)?t.length:this.getLength(t,i);return this.optional(i)||s>=a},maxlength:function(t,i,a){var s=e.isArray(t)?t.length:this.getLength(t,i);return this.optional(i)||s<=a},rangelength:function(t,i,a){var s=e.isArray(t)?t.length:this.getLength(t,i);return this.optional(i)||s>=a[0]&&s<=a[1]},min:function(e,t,i){return this.optional(t)||e>=i},max:function(e,t,i){return this.optional(t)||e<=i},range:function(e,t,i){return this.optional(t)||e>=i[0]&&e<=i[1]},step:function(t,i,a){var s,r=e(i).attr("type"),n="Step attribute on input type "+r+" is not supported.",l=["text","number","range"],o=RegExp("\\b"+r+"\\b"),d=r&&!o.test(l.join()),c=function(e){var t=(""+e).match(/(?:\.(\d+))?$/);return t&&t[1]?t[1].length:0},h=function(e){return Math.round(e*Math.pow(10,s))},f=!0;if(d)throw Error(n);return s=c(a),(c(t)>s||h(t)%h(a)!=0)&&(f=!1),this.optional(i)||f},equalTo:function(t,i,a){var s=e(a);return this.settings.onfocusout&&s.not(".validate-equalTo-blur").length&&s.addClass("validate-equalTo-blur").on("blur.validate-equalTo",function(){e(i).valid()}),t===s.val()},remote:function(t,i,a,s){if(this.optional(i))return"dependency-mismatch";s="string"==typeof s&&s||"remote";var r,n,l,o=this.previousValue(i,s);return(this.settings.messages[i.name]||(this.settings.messages[i.name]={}),o.originalMessage=o.originalMessage||this.settings.messages[i.name][s],this.settings.messages[i.name][s]=o.message,a="string"==typeof a&&{url:a}||a,l=e.param(e.extend({data:t},a.data)),o.old===l)?o.valid:(o.old=l,r=this,this.startRequest(i),(n={})[i.name]=t,e.ajax(e.extend(!0,{mode:"abort",port:"validate"+i.name,dataType:"json",data:n,context:r.currentForm,success:function(e){var a,n,l,d=!0===e||"true"===e;r.settings.messages[i.name][s]=o.originalMessage,d?(l=r.formSubmitted,r.resetInternals(),r.toHide=r.errorsFor(i),r.formSubmitted=l,r.successList.push(i),r.invalid[i.name]=!1,r.showErrors()):(a={},n=e||r.defaultMessage(i,{method:s,parameters:t}),a[i.name]=o.message=n,r.invalid[i.name]=!0,r.showErrors(a)),o.valid=d,r.stopRequest(i,d)}},a)),"pending")}}});var t,i={};return e.ajaxPrefilter?e.ajaxPrefilter(function(e,t,a){var s=e.port;"abort"===e.mode&&(i[s]&&i[s].abort(),i[s]=a)}):(t=e.ajax,e.ajax=function(a){var s=("mode"in a?a:e.ajaxSettings).mode,r=("port"in a?a:e.ajaxSettings).port;return"abort"===s?(i[r]&&i[r].abort(),i[r]=t.apply(this,arguments),i[r]):t.apply(this,arguments)}),e}),(fbuilderjQuery="undefined"!=typeof fbuilderjQuery?fbuilderjQuery:jQuery)(function(){!function($){$.fbuilder=$.fbuilder||{},$.fbuilder.objName="fbuilderjQuery",$.fbuilder.controls=void 0!==$.fbuilder.controls?$.fbuilder.controls:{},$.fbuilder.forms=void 0!==$.fbuilder.forms?$.fbuilder.forms:{},$.fbuilder.htmlEncode=function(e){return e=(e=$("<div/>").text(e).html()).replace(/&/g,"&amp;").replace(/"/g,"&quot;")},$.fbuilder.configValidate=function(e){e.validate({ignore:".ignore,.ignorepb",errorElement:"div",errorClass:"cpefb_error",errorPlacement:function(e,t){t.parents(".dfield").find(".cpefb_error.message").not("[style]").length>0||(e.insertAfter(t.parents(".dfield").children().last()),e.addClass("message"))}})},$.fbuilder.htmlDecode=function(e){return/&(?:#x[a-f0-9]+|#[0-9]+|[a-z0-9]+);?/ig.test(e)&&(e=$("<div/>").html(e).text()),e},$.fbuilder.escape_symbol=function(e){return e.replace(/([\^\$\-\.\,\[\]\(\)\/\\\*\?\+\!\{\}])/g,"\\$1")},$.fbuilder.parseValStr=function(e){return'"'+e.replace(/'/g,"\\'").replace(/\$/g,"")+'"'},$.fbuilder.parseVal=function(e,t,i){if(""==e)return 0;e+="",t=RegExp($.fbuilder.escape_symbol(void 0===t?",":t),"g"),i=RegExp($.fbuilder.escape_symbol(void 0===i?".":i),"g");var a=e.replace(t,"").replace(i,".").replace(/\s/g,""),s=/[+-]?((\d+(\.\d+)?)|(\.\d+))/.exec(a);return s?1*s[0]:$.fbuilder.parseValStr(e)},$.fn.fbuilder=function(options){var opt=$.extend({},{pub:!1,identifier:"",title:""},options,!0);opt.messages=$.extend({previous:"Previous",next:"Next",pageof:"Page {0} of {0}",required:"This field is required.",email:"Please enter a valid email address.",datemmddyyyy:"Please enter a valid date with this format(mm/dd/yyyy)",dateddmmyyyy:"Please enter a valid date with this format(dd/mm/yyyy)",number:"Please enter a valid number.",digits:"Please enter only digits.",maxlength:$.validator.format("Please enter no more than {0} characters"),minlength:$.validator.format("Please enter at least {0} characters."),equalTo:"Please enter the same value again.",max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},opt.messages),opt.messages.max=$.validator.format(opt.messages.max),opt.messages.min=$.validator.format(opt.messages.min),$.extend($.validator.messages,opt.messages);var items=[],reloadItemsPublic=function(){$("#fieldlist"+opt.identifier).closest("form").addClass(theForm.formtemplate),$("#fieldlist"+opt.identifier).html("").addClass(theForm.formlayout),$("#formheader"+opt.identifier).html(theForm.show());var e=0;$("#fieldlist"+opt.identifier).append('<div class="pb'+e+' pbreak" page="'+e+'"></div>');for(var t=0;t<items.length;t++)if(items[t].index=t,"fPageBreak"==items[t].ftype)e++,$("#fieldlist"+opt.identifier).append('<div class="pb'+e+' pbreak" page="'+e+'"></div>');else if($("#fieldlist"+opt.identifier+" .pb"+e).append(items[t].show()),items[t].predefinedClick&&($("#fieldlist"+opt.identifier+" .pb"+e).find("#"+items[t].name).attr("placeholder",items[t].predefined),$("#fieldlist"+opt.identifier+" .pb"+e).find("#"+items[t].name).attr("value","")),items[t].userhelpTooltip){var i=$("#fieldlist"+opt.identifier+" .pb"+e).find("#"+items[t].name).closest(".fields");i.find(".uh").css("display","none"),""!=i.find(".uh").text()&&i.attr("uh",i.find(".uh").text())}if(e>0?($("#fieldlist"+opt.identifier+" .pb"+e).addClass("pbEnd"),$("#fieldlist"+opt.identifier+" .pbreak").each(function(t){var i=$(this).html(),a="";t==e&&($("#cpcaptchalayer"+opt.identifier).length&&!/^\s*$/.test($("#cpcaptchalayer"+opt.identifier).html())&&(i+='<div class="captcha">'+$("#cpcaptchalayer"+opt.identifier).html()+'</div><div class="clearer"></div>',$("#cpcaptchalayer"+opt.identifier).html("")),$("#cp_subbtn"+opt.identifier).html()&&(a='<button type="button" class="pbSubmit">'+$("#cp_subbtn"+opt.identifier).html()+"</button>")),$(this).html("<fieldset><legend>"+opt.messages.pageof.replace(/\{\s*\d+\s*\}/,t+1).replace(/\{\s*\d+\s*\}/,e+1)+"</legend>"+i+'<div class="pbPrevious">'+opt.messages.previous+'</div><div class="pbNext">'+opt.messages.next+"</div>"+a+'<div class="clearer"></div></fieldset>')}),$("#fieldlist"+opt.identifier).find(".pbPrevious,.pbNext").bind("click",{identifier:opt.identifier},function(e){var t=e.data.identifier;function i(){try{$("html, body").animate({scrollTop:$("#fieldlist"+t+" .pb"+a).find("fieldset").offset().top},100)}catch(e){}}if($(this).hasClass("pbPrevious")||$(this).hasClass("pbNext")&&$(this).parents("form").valid()){var a=parseInt($(this).parents(".pbreak").attr("page"));if($(this).hasClass("pbPrevious")?a--:a++,$("#fieldlist"+t+" .pbreak").css("display","none"),$("#fieldlist"+t+" .pbreak").find(".field").addClass("ignorepb"),$("#fieldlist"+t+" .pb"+a).css("display","block"),$("#fieldlist"+t+" .pb"+a).find(".field").removeClass("ignorepb"),$("#fieldlist"+t+" .pb"+a).find(".field").length>0)try{$("#fieldlist"+t+" .pb"+a).find(".field").is(":visible")?$("#fieldlist"+t+" .pb"+a).find(".field")[0].focus():i()}catch(s){i()}else i()}else $(this).parents("form").validate().focusInvalid();return!1})):($("#cpcaptchalayer"+opt.identifier).length&&!/^\s*$/.test($("#cpcaptchalayer"+opt.identifier).html())&&($("#fieldlist"+opt.identifier+" .pb"+e).append('<div class="captcha">'+$("#cpcaptchalayer"+opt.identifier).html()+"</div>"),$("#cpcaptchalayer"+opt.identifier).html("")),$("#cp_subbtn"+opt.identifier).html()&&$("#fieldlist"+opt.identifier+" .pb"+e).append('<button type="button" class="pbSubmit">'+$("#cp_subbtn"+opt.identifier).html()+"</button>")),$(document).on("click","#fbuilder .captcha img",function(){var e=$(this);e.attr("src",e.attr("src").replace(/&\d+$/,"")+"&"+Math.floor(1e3*Math.random()))}),$(document).on("click","#fieldlist"+opt.identifier+" .pbSubmit",function(e){$("#fieldlist"+opt.identifier+" .pbSubmit").closest("form").submit()}),t>0){theForm.after_show(opt.identifier);for(var t=0;t<items.length;t++)items[t].after_show();$.fbuilder.showHideDep({formIdentifier:opt.identifier,throwEvent:!0}),$("#fieldlist"+opt.identifier).find(".depItemSel,.depItem").bind("change",{identifier:opt.identifier},function(e){$.fbuilder.showHideDep({formIdentifier:e.data.identifier,throwEvent:!0})});try{$("#fbuilder"+opt.identifier).tooltip({show:!1,hide:!1,tooltipClass:"uh-tooltip",position:{my:"left top",at:"left bottom+5",collision:"none"},items:"[uh]",content:function(){return $(this).attr("uh")}})}catch(a){}}if($("#fieldlist"+opt.identifier+" .pbreak:not(.pb0)").find(".field").addClass("ignorepb"),theForm.autofocus){var s=$("#fieldlist"+opt.identifier+" .pbreak.pb0").find(":focusable:first");s&&"radio"!=s.attr("type")&&"checkbox"!=s.attr("type")&&0==s.closest("[uh]").length&&s.focus()}},fform=function(){};$.extend(fform.prototype,{title:"Untitled Form",description:"This is my form. Please fill it out. It's awesome!",formlayout:"top_aligned",formtemplate:"",evalequations:1,autocomplete:1,autofocus:!1,show:function(){return'<div class="fform" id="field">'+(""!=this.title?"<h1>"+this.title+"</h1>":"")+(""!=this.description?"<span>"+this.description+"</span>":"")+"</div>"},after_show:function(e){$("#cp_calculatedfieldsf_pform"+e).attr("data-evalequations",this.evalequations).attr("autocomplete",this.autocomplete?"on":"off")}});var theForm,ffunct={getItem:function(e){for(var t in items)if(items[t].name==e)return items[t];return!1},getItems:function(){return items},loadData:function(f){var d,e=$("#"+f);if(this.formId=e.parents("form").attr("id"),(d=$.parseJSON(e.val()))&&2==d.length){items=[];for(var i=0;i<d[0].length;i++){var obj=eval("new $.fbuilder.controls['"+d[0][i].ftype+"']();");(obj=$.extend(!0,{},obj,d[0][i])).name=obj.name+opt.identifier,obj.form_identifier=opt.identifier,obj.init(),items[items.length]=obj}theForm=new fform,theForm=$.extend(theForm,d[1][0]),reloadItemsPublic()}void 0!==window.cpcff_load_defaults&&window.cpcff_load_defaults()}};return $.fbuilder.forms[opt.identifier]=ffunct,this.fBuild=ffunct,this},$.fbuilder.showSettings={formlayoutList:[{id:"top_aligned",name:"Top Aligned"},{id:"left_aligned",name:"Left Aligned"},{id:"right_aligned",name:"Right Aligned"},{id:"center_aligned",name:"Center Aligned"}]},$.fbuilder.controls.ffields=function(){},$.extend($.fbuilder.controls.ffields.prototype,{form_identifier:"",name:"",shortlabel:"",index:-1,ftype:"",userhelp:"",userhelpTooltip:!1,csslayout:"",init:function(){},show:function(){return"Not available yet"},after_show:function(){},val:function(){var e=$("[id='"+this.name+"']:not(.ignore)");return e.length?$.fbuilder.parseVal($.trim(e.val())):0}}),$.fbuilder.showHideDep=function(e){if(void 0!==e.formIdentifier){var t=e.formIdentifier;if(void 0!==$.fbuilder.forms[t]){for(var i=[],a=[],s=$.fbuilder.forms[t].getItems(),r=0,n=s.length;r<n;r++)void 0!==s[r].showHideDep&&s[r].showHideDep(i,a);(void 0===e.throwEvent||e.throwEvent)&&$(document).trigger("showHideDepEvent",$.fbuilder.forms[t].formId)}}},$.fbuilder.controls.ftext=function(){},$.extend($.fbuilder.controls.ftext.prototype,$.fbuilder.controls.ffields.prototype,{title:"Untitled",ftype:"ftext",predefined:"",predefinedClick:!1,required:!1,size:"medium",minlength:"",maxlength:"",equalTo:"",show:function(){return'<div class="fields '+$.fbuilder.htmlEncode(this.csslayout)+'" id="field'+this.form_identifier+"-"+this.index+'"><label for="'+this.name+'">'+this.title+(this.required?"<span class='r'>*</span>":"")+'</label><div class="dfield"><input id="'+this.name+'" name="'+this.name+'" '+(""!=this.minlength?' minlength="'+parseInt(this.minlength)+'"':"")+" "+(""!=this.maxlength?' maxlength="'+parseInt(this.maxlength)+'"':"")+" "+(""!=this.equalTo?'equalTo="#'+$.fbuilder.htmlEncode(this.equalTo+this.form_identifier)+'"':"")+' class="field '+this.size+(this.required?" required":"")+'" type="text" value="'+$.fbuilder.htmlEncode(this.predefined)+'"/><span class="uh">'+this.userhelp+'</span></div><div class="clearer"></div></div>'}}),$.fbuilder.controls.femail=function(){},$.extend($.fbuilder.controls.femail.prototype,$.fbuilder.controls.ffields.prototype,{title:"Email",ftype:"femail",predefined:"",predefinedClick:!1,required:!1,size:"medium",equalTo:"",show:function(){return'<div class="fields '+$.fbuilder.htmlEncode(this.csslayout)+'" id="field'+this.form_identifier+"-"+this.index+'"><label for="'+this.name+'">'+this.title+(this.required?"<span class='r'>*</span>":"")+'</label><div class="dfield"><input id="'+this.name+'" name="'+this.name+'" '+(""!=this.equalTo?'equalTo="#'+$.fbuilder.htmlEncode(this.equalTo+this.form_identifier)+'"':"")+' class="field email '+this.size+(this.required?" required":"")+'" type="text" value="'+$.fbuilder.htmlEncode(this.predefined)+'"/><span class="uh">'+this.userhelp+'</span></div><div class="clearer"></div></div>'},val:function(){var e=$('[id="'+this.name+'"]:not(.ignore)');return e.length?$.fbuilder.parseValStr(e.val()):""}}),$.fbuilder.nDate=function(){if($("#ahbstid").length>0&&""!=$("#ahbstid").val())return"undefined"!=typeof cp_hourbk_timezone?new Date(new Date($("#ahbstid").val()).getTime()+36e5*cp_hourbk_timezone):new Date($("#ahbstid").val());return new Date},$.fbuilder.controls.fapp=function(){},$.extend($.fbuilder.controls.fapp.prototype,$.fbuilder.controls.ffields.prototype,{title:"Number",ftype:"fapp",services:Array({name:"Service 1",price:1,capacity:1,duration:60,pb:0,pa:0,ohindex:0}),openhours:[],allOH:Array({name:"Default",openhours:Array({type:"all",d:"",h1:8,m1:0,h2:17,m2:0})}),usedSlots:[],dateFormat:"mm/dd/yy",showDropdown:!1,showTotalCost:!1,showTotalCostFormat:"$ {0}",showEndTime:!1,usedSlotsCheckbox:!1,avoidOverlaping:!0,emptySelectCheckbox:!1,emptySelect:"-- Please select service --",dropdownRange:"-10:+10",working_dates:[!0,!0,!0,!0,!0,!0,!0],numberOfMonths:1,maxNumberOfApp:0,showAllServices:!1,allowDifferentQuantities:!1,allowSelectSameSlot:!1,firstDay:0,minDate:"0",maxDate:"",defaultDate:"",invalidDates:"",required:!0,bSlotsCheckbox:!0,bSlots:30,militaryTime:1,cacheArr:[],getD:$.fbuilder.nDate(),formId:0,getMinDate:"",getMaxDate:"",arr:[],allUsedSlots:[],service_selected:0,quantity_selected:1,tz:0,tzCache:[],loadOK:!1,ignoreUsedSlots:!1,initialapp:"",initialID:0,pctByDay:[],htmlUsedSlots:[],extras:0,sub_cost:0,percent:0,notShowBookedDate:!0,showWeek:!1,autonum:0,availableSlotsByService:[],slotsDate:[],allowTZCache:!0,getSplittedSlots:function(e,t){function i(e,t){for(var i=[],a=0;a<e.length;a++)i[i.length]=e[a].t1,i[i.length]=e[a].t2;i.sort(function(e,t){return e-t});for(var s=[],a=0;a<i.length;a++)(0==a||i[a]!=i[a-1])&&(s[s.length]=i[a]);for(var r=[],a=0;a<s.length-1;a++){for(var n=s[a],l=s[a+1],o=n%60,d=l%60,c={t1:n,t2:l,quantity:0,serviceindex:t,h1:(n-o)/60,m1:o,h2:(l-d)/60,m2:d},h=0;h<e.length;h++)(n>e[h].t1&&n<e[h].t2||l>e[h].t1&&l<e[h].t2||n==e[h].t1&&l==e[h].t2)&&(c.quantity+=e[h].quantity);c.quantity&&(r[r.length]=c)}return r}var a=[];e.sort(function(e,t){return void 0!==e.serviceindex&&void 0!==t.serviceindex?e.serviceindex-t.serviceindex:void 0===e.serviceindex?-1-t.serviceindex:e.serviceindex- -1});for(var s=-2,r=[],n=0;n<e.length;n++)void 0!==e[n].serviceindex?(e[n].serviceindex!=s&&(0!=n&&(a=a.concat(i(r,s))),r=[],s=e[n].serviceindex),r[r.length]=jQuery.extend({},e[n])):a[a.length]=jQuery.extend({},e[n]);return 0!=r.length&&(a=a.concat(i(r,s))),a},getCompatSlots:function(e){for(var t=[],i=!1,a=0;a<e.length;a++){e[a].quantity||(e[a].quantity=1e3);var s=-1;void 0!==e[a].serviceindex&&(s=e[a].serviceindex),e[a].service=[],e[a].service[0]=s,i=!1;for(var r=0;r<t.length&&!i;r++)e[a].t1==t[r].t1&&e[a].t2==t[r].t2&&e[a].serviceindex==t[r].serviceindex&&(t[r].quantity+=e[a].quantity,t[r].currentSelection=t[r].currentSelection||e[a].currentSelection||!1,$.inArray(e[a].service[0],t[r].service)||(t[r].service[t[r].service.length]=e[a].service[0]),i=!0);i||(t[t.length]=jQuery.extend({},e[a]))}return t},normalizeSelectIndex:function(e){return this.emptySelectCheckbox&&e>0&&e--,e},show:function(){return'<div class="fields '+$.fbuilder.htmlEncode(this.csslayout)+'" id="field'+this.form_identifier+"-"+this.index+'"><label for="'+this.name+'">'+this.title+(this.required?"<span class='r'>*</span>":"")+'</label><div class="dfield fapp"><input class="field avoid_overlapping_before '+(this.required?" required":"")+'" id="'+this.name+'" name="'+this.name+'" type="hidden" value="" summary="usedSlots"/><input id="'+this.name+'_services" name="'+this.name+'_services" type="hidden" value="0"/><input id="'+this.name+'_capacity" name="'+this.name+'_capacity" type="hidden" value="0"/><input class="" id="tcost'+this.name+'" name="tcost'+this.name+'" type="hidden" value=""/><div class="fieldCalendarService fieldCalendarService'+this.name+'"></div><div class="fieldCalendar fieldCalendar'+this.name+'"></div><div class="slotsCalendar slotsCalendar'+this.name+'"></div><div class="usedSlots usedSlots'+this.name+'"></div><span class="uh">'+this.userhelp+'</span></div><div class="clearer"></div></div>'},tzf:function(e){function t(e,t){var i=-1*new Date($.datepicker.parseDate("yy-mm-dd",t).getTime()+432e5).getTimezoneOffset()/60-parseFloat(cp_hourbk_timezone);if("undefined"!=typeof cp_hourbk_observedaylight&&cp_hourbk_observedaylight)try{$.datepicker.parseDate("yy-mm-dd",cp_hourbk_daylightnextchange).getTime()<=$.datepicker.parseDate("yy-mm-dd",t).getTime()&&(i+=parseFloat(cp_hourbk_daylightnexaction))}catch(a){}return e.tzCache[t]=i,i}return"undefined"!=typeof cp_hourbk_timezone?void 0!==this.tzCache[e]&&this.allowTZCache?this.tzCache[e]:t(this,e):this.tz},getSpecialDays:function(){var e=this,t=[];if(!e.emptySelectCheckbox||e.emptySelectCheckbox&&$(".fieldCalendarService"+e.name+" select option:selected").index()>0){for(var i=e.services[e.normalizeSelectIndex($(".fieldCalendarService"+e.name+" select option:selected").index())].ohindex,a=0;a<e.allOH[i].openhours.length;a++)if("special"==e.allOH[i].openhours[a].type)t[t.length]=e.allOH[i].openhours[a].d;else if("specialrange"==e.allOH[i].openhours[a].type&&""!=e.allOH[i].openhours[a].d){var s=e.allOH[i].openhours[a].d.split(":");if(2==s.length)for(fromD=$.datepicker.parseDate("yy-mm-dd",s[0]),toD=$.datepicker.parseDate("yy-mm-dd",s[1]),fromD.setDate(fromD.getDate()+1);fromD<=toD;){var r=$.datepicker.formatDate("yy-mm-dd",fromD);t[t.length]=r,fromD.setDate(fromD.getDate()+1)}t[t.length]=s[0]}}return t},getServiceInd:function(e){var t=this;if(void 0===t.getServiceIndArr){t.getServiceIndArr=[];for(var i=0;i<t.services.length;i++)t.getServiceIndArr["idx"+t.services[i].idx]=i}return void 0!==t.getServiceIndArr["idx"+e]?t.getServiceIndArr["idx"+e]:-1},normalizeRanges:function(e){for(var t=0;t<e.length;t++)e[t].t1=60*e[t].h1+1*e[t].m1,e[t].t2=60*e[t].h2+1*e[t].m2,e[t].t1>=e[t].t2&&(e[t].t2+=1440)},initcacheOpenHours:function(){var e=this;for(j=0;j<e.allOH.length;j++)e.normalizeRanges(e.allOH[j].openhours);for(j=0,e.cacheOpenHours=[];j<e.services.length;j++){for(var t=e.services[j].ohindex,i=[],a=0;a<e.allOH[t].openhours.length;a++)if("special"==e.allOH[t].openhours[a].type)i[e.allOH[t].openhours[a].d]=i[e.allOH[t].openhours[a].d]||[],i[e.allOH[t].openhours[a].d][i[e.allOH[t].openhours[a].d].length]=jQuery.extend({capacity:e.services[j].capacity},e.allOH[t].openhours[a]);else if("specialrange"==e.allOH[t].openhours[a].type){if(""!=e.allOH[t].openhours[a].d){var s=e.allOH[t].openhours[a].d.split(":");if(2==s.length)for(fromD=$.datepicker.parseDate("yy-mm-dd",s[0]),toD=$.datepicker.parseDate("yy-mm-dd",s[1]),fromD.setDate(fromD.getDate()+1);fromD<=toD;){var r=$.datepicker.formatDate("yy-mm-dd",fromD);i[r]=i[r]||[],i[r][i[r].length]=jQuery.extend({capacity:e.services[j].capacity},e.allOH[t].openhours[a]),fromD.setDate(fromD.getDate()+1)}i[s[0]]=i[s[0]]||[],i[s[0]][i[s[0]].length]=jQuery.extend({capacity:e.services[j].capacity},e.allOH[t].openhours[a])}}else i[e.allOH[t].openhours[a].type]=i[e.allOH[t].openhours[a].type]||[],i[e.allOH[t].openhours[a].type][i[e.allOH[t].openhours[a].type].length]=jQuery.extend({capacity:e.services[j].capacity},e.allOH[t].openhours[a]);e.cacheOpenHours[j]=i}},getAvailablePartialSlots:function(e,t,i){var a=this;if(-1==$.inArray(e,a.special_days)){var s=$.datepicker.parseDate("yy-mm-dd",e);if(0==a.working_dates[s.getDay()])return[];for(var r=0,n=a.invalidDates.length;r<n;r++)if(s.getTime()===a.invalidDates[r].getTime())return[]}var l=a.services[i].capacity,o=[];if(a.cacheOpenHours[i][e]?o=a.cacheOpenHours[i][e].slice(0):a.cacheOpenHours[i]["d"+$.datepicker.parseDate("yy-mm-dd",e).getDay()]?o=a.cacheOpenHours[i]["d"+$.datepicker.parseDate("yy-mm-dd",e).getDay()].slice(0):a.cacheOpenHours[i].all&&(o=a.cacheOpenHours[i].all.slice(0)),a.arr[e]=o,!a.duration){var d=[];return d}var c=a.cacheArr[e];c||(c=[]);var h=parseFloat(a.services[i].duration);a.duration=h,a.bduration=a.duration,a.bSlotsCheckbox||(a.bduration=1*a.bSlots);for(var d=[],r=0;r<a.arr[e].length;r++)d[r]=jQuery.extend({},a.arr[e][r]);for(var r=0;r<d.length;r++)d[r].t1=60*d[r].h1+1*d[r].m1,d[r].t2=60*d[r].h2+1*d[r].m2,d[r].t1>=d[r].t2&&(d[r].t2+=1440);if(a.ignoreUsedSlots)var f=$.merge(c.slice(0),[]);else{a.usedSlots[e]=a.usedSlots[e]||[];var f=$.merge(c.slice(0),a.usedSlots[e]),u=$.datepicker.parseDate("yy-mm-dd",e);u.setDate(u.getDate()-1);var m=$.datepicker.formatDate("yy-mm-dd",u);a.usedSlots[m]=a.usedSlots[m]||[];for(var r=0;r<a.usedSlots[m].length;r++)if(a.usedSlots[m][r].h1>a.usedSlots[m][r].h2&&0!=a.usedSlots[m][r].h2||a.usedSlots[m][r].h2>24){a.usedSlots[m][r].h1>a.usedSlots[m][r].h2&&(a.usedSlots[m][r].h2+=24);var p=jQuery.extend({},a.usedSlots[m][r]);p.h2=a.usedSlots[m][r].h2-24,p.h1=0,p.m1=0,p.d=e,f[f.length]=p}}for(var r=0;r<f.length;r++)if(f[r].t1=60*f[r].h1+1*f[r].m1,f[r].t2=60*f[r].h2+1*f[r].m2,void 0!==f[r].serviceindex&&void 0===f[r].nopadding)try{f[r].t1==f[r].t2&&(f[r].t2+=1440),f[r].t1-=a.services[f[r].serviceindex].pb,f[r].t2+=a.services[f[r].serviceindex].pa}catch(g){}for(var b=$.merge(f,t),r=0;r<b.length;r++)b[r].t1=b[r].t1||60*b[r].h1+1*b[r].m1,b[r].t2=b[r].t2||60*b[r].h2+1*b[r].m2,b[r].t1>b[r].t2&&(b[r].t2+=1440);"undefined"!=typeof cp_hourbk_cmpublic&&(b=a.getSplittedSlots(b,i)),b=a.getCompatSlots(b);for(var r=0;r<b.length;r++)if(a.avoidOverlaping&&(b[r].quantity+a.quantity_selected>l||0==b[r].service.length||b[r].service.length&&b[r].service[0]!=i)||!a.avoidOverlaping&&(b[r].quantity+a.quantity_selected>l&&b[r].serviceindex==i||void 0===b[r].serviceindex))for(var y=0;y<d.length;y++)if(b[r].t1>d[y].t1&&b[r].t1<d[y].t2&&b[r].t2>d[y].t1&&b[r].t2<d[y].t2){var _={t1:d[y].t1,t2:b[r].t1,h1:d[y].h1,h2:b[r].h1,m1:d[y].m1,m2:b[r].m1},S={t1:b[r].t2,t2:d[y].t2,h1:b[r].h2,h2:d[y].h2,m1:b[r].m2,m2:d[y].m2};d.splice(y,1,_,S),y--}else b[r].t1>d[y].t1&&b[r].t1<d[y].t2?(d[y].t2=b[r].t1,d[y].h2=b[r].h1,d[y].m2=b[r].m1):b[r].t2>d[y].t1&&b[r].t2<d[y].t2?(d[y].t1=b[r].t2,d[y].h1=b[r].h2,d[y].m1=b[r].m2):b[r].t1<=d[y].t1&&b[r].t2>=d[y].t2&&(d.splice(y,1),y--);for(var r=0;r<d.length;r++)d[r].day=e;if(""!==a.minDate&&""!=a.getMinDate){for(var x=a.getMinDate,D=x.getTime()-36e5*a.tzf(e),r=d.length-1;r>=0;r--)if($.datepicker.parseDate("yy-mm-dd",d[r].day).getTime()+6e4*d[r].t2<=D)d.splice(r,1);else if($.datepicker.parseDate("yy-mm-dd",d[r].day).getTime()+6e4*d[r].t1<=D){for(var k=d[r].t1;$.datepicker.parseDate("yy-mm-dd",d[r].day).getTime()+6e4*k<D;)a.bSlotsCheckbox?k+=h+a.pb+a.pa:k+=a.bduration;var C=k%60,w=(k-C)/60;d[r].t1=k,d[r].h1=w,d[r].m1=C}}if(""!==a.maxDate&&""!=a.getMaxDate){for(var x=a.getMaxDate,D=x.getTime()+36e5*a.tzf(e),r=d.length-1;r>=0;r--)if($.datepicker.parseDate("yy-mm-dd",d[r].day).getTime()+6e4*d[r].t1>=D)d.splice(r,1);else if($.datepicker.parseDate("yy-mm-dd",d[r].day).getTime()+6e4*d[r].t2>=D){for(var q=d[r].t1;$.datepicker.parseDate("yy-mm-dd",d[r].day).getTime()+(q+h)*6e4<=D;)q+=h;var A=q%60,O=(q-A)/60;d[r].t2=q,d[r].h2=O,d[r].m2=A}}for(var r=d.length-1;r>=0;r--)(d[r].t1+h+a.pb+a.pa>d[r].t2||d[r].t1>1440)&&d.splice(r,1);return d},formattime:function(e,t){e<0&&(e+=1440);var i=Math.floor((e%=1440)/60),a=e%60,s="";return 0==t&&(i>12?(i-=12,s=" PM"):12==i?s=" PM":(0==i&&2!=t&&(i=12),s=" AM")),(i<10?"0":"")+i+":"+(a<10?"0":"")+a+s},formatString:function(e,t,i){var a=this;i*=60,void 0===e.st&&(e.st=60*e.h1+1*e.m1),void 0===e.et&&(e.et=60*e.h2+1*e.m2);var s="";if(t){var r=$.datepicker.parseDate("yy-mm-dd",e.d);0!=i&&(e.st+i<0?r.setDate(r.getDate()-1):e.st+i>1440&&r.setDate(r.getDate()+1)),s+='<span class="d">'+$.datepicker.formatDate(a.dateFormat,r)+"</span> "}return s+=t?'<span class="t">':"",s+=a.formattime(e.st+i,a.militaryTime)+(a.showEndTime?"-"+a.formattime(e.et+i,a.militaryTime):""),s+=t?"</span>":""},getCurrentSlots:function(e,t,i){for(var a=this,s=parseFloat(a.services[i].duration),r="",n=[],l=0,o=0,d=!1,c=a.services[i].capacity,h=a.getCompatSlots(a.htmlUsedSlots[t]),f=0;f<h.length;f++)if(h[f].serviceindex==i){h[f].st=60*h[f].h1+h[f].m1,h[f].t=$.datepicker.parseDate("yy-mm-dd",h[f].d).getTime()+6e4*h[f].st,h[f].html="";var d=!1;if(""!==a.minDate&&""!=a.getMinDate){var u=a.getMinDate.getTime()-36e5*a.tzf(t);h[f].t>u&&(d=!0)}else d=!0;d&&((h[f].quantity>=c||h[f].currentSelection)&&(h[f].html='<div s="'+i+'" h1="'+h[f].h1+'" m1="'+h[f].m1+'" h2="'+h[f].h2+'" m2="'+h[f].m2+'" style="'+(a.usedSlotsCheckbox?"":"display:none")+'" class="htmlUsed  '+(void 0!==h[f].s?h[f].s.replace(/ /g,"").toLowerCase()+" old":" choosen")+'"><a '+(void 0!==h[f].e?'title="'+h[f].e+'"':"")+">"+a.formatString(h[f],!1,a.tzf(t))+"</a>"+(void 0!==h[f].e?'<div class="ahbmoreinfo">'+h[f].e+"</div>":"")+"</div>"),h[f].availableslot=!1,n[n.length]=h[f])}"undefined"==typeof specialPadding&&(l=a.pb,o=a.pa);for(var f=0;f<e.length;f++)for((st=e[f].t1||60*e[f].h1+1*e[f].m1)>=(et=e[f].t2||60*e[f].h2+1*e[f].m2)&&(et+=1440),st+=a.pb;st+s+a.pa<=et&&st<1440;)r='<div class="availableslot"><a  s="'+i+'"  href="" d="'+e[f].day+'" h1="'+Math.floor(st/60)+'" m1="'+st%60+'" h2="'+Math.floor((st+s)/60)+'" m2="'+(st+s)%60+'">'+a.formatString({st:st,et:st+s},!1,a.tzf(t))+("undefined"!=typeof cp_hourbk_cmpublic?'<span class="ahb_slot_availability"><span class="p">ahbslotavailabilityP</span><span class="t">ahbslotavailabilityT</span></span>':"")+"</a></div>",n[n.length]={availableslot:!0,st:st,serviceindex:i,h1:Math.floor(st/60),m1:st%60,h2:Math.floor((st+s)/60),m2:(st+s)%60,html:r,t:$.datepicker.parseDate("yy-mm-dd",e[f].day).getTime()+6e4*st},a.bSlotsCheckbox?st+=a.bduration+o+l:st+=a.bduration;if(n.sort(function(e,t){return"undefined"!=typeof cp_hourbk_cmpublic&&e.t==t.t&&(void 0!==e.quantity&&void 0===t.quantity?(t.html=t.html.replace("ahbslotavailabilityP",c-e.quantity),t.quantity=e.quantity):void 0!==t.quantity&&void 0===e.quantity&&(e.html=e.html.replace("ahbslotavailabilityP",c-t.quantity),e.quantity=t.quantity)),e.t-t.t}),n=(n=n.reduce(function(e,t){return 0==e.filter(function(e){return t.html==e.html}).length&&e.push(t),e},[])).reduce(function(e,t){if(0==e.filter(function(e){return t.t==e.t}).length)e.push(t);else for(var i=0;i<e.length;i++)if(e[i].t==t.t&&!e[i].availableslot&&(t.availableslot||t.currentSelection)){e[i]=t;break}return e},[]),a.usedSlots[t]=a.usedSlots[t]||[],a.usedSlots[t].length>0&&n.length>0)for(var f=0;f<a.usedSlots[t].length;f++)for(var m=0;m<n.length;m++)n[m].serviceindex==a.usedSlots[t][f].serviceindex&&n[m].h1==a.usedSlots[t][f].h1&&n[m].m1==a.usedSlots[t][f].m1&&n[m].h2==a.usedSlots[t][f].h2&&n[m].m2==a.usedSlots[t][f].m2&&(-1==n[m].html.indexOf("currentSelection")&&(n[m].html=n[m].html.replace("htmlUsed","htmlUsed currentSelection")),-1==n[m].html.indexOf("currentSelection")&&(n[m].html=n[m].html.replace("availableslot","availableslot currentSelection")));return n},getAvailableSlotsByService:function(e,t){var i=this,a="s"+t+"q"+i.quantity_selected+"d"+e;if(0==i.tzf(e)&&void 0!==i.slotsDate[a])return i.slotsDate[a];function s(e,t,a){t*=60,a*=60;var s=[];i.cacheArr[e]=i.cacheArr[e]||[];for(var r=0;r<i.cacheArr[e].length;r++)i.cacheArr[e][r].t1=i.cacheArr[e][r].t1||60*i.cacheArr[e][r].h1+1*i.cacheArr[e][r].m1,i.cacheArr[e][r].t2=i.cacheArr[e][r].t2||60*i.cacheArr[e][r].h2+1*i.cacheArr[e][r].m2,i.cacheArr[e][r].t1>=i.cacheArr[e][r].t2&&(i.cacheArr[e][r].t2+=1440),t<=i.cacheArr[e][r].t1&&a>=i.cacheArr[e][r].t1&&(s[s.length]=jQuery.extend({},i.cacheArr[e][r]));for(var r=0;i.usedSlots[e]&&r<i.usedSlots[e].length;r++)i.usedSlots[e][r].t1=i.usedSlots[e][r].t1||60*i.usedSlots[e][r].h1+1*i.usedSlots[e][r].m1,i.usedSlots[e][r].t2=i.usedSlots[e][r].t2||60*i.usedSlots[e][r].h2+1*i.usedSlots[e][r].m2,i.usedSlots[e][r].t1>=i.usedSlots[e][r].t2&&(i.usedSlots[e][r].t2+=1440),t<=i.usedSlots[e][r].t1&&a>=i.usedSlots[e][r].t1&&(s[s.length]=jQuery.extend({},i.usedSlots[e][r]));return s}var r=$.datepicker.parseDate("yy-mm-dd",e);if(0==this.tzf(e)){i.htmlUsedSlots[e]=s(e,0,24);var n=this.getAvailablePartialSlots(e,[{h1:0,m1:0,h2:0,m2:0}],t)}else if(this.tzf(e)>0){r.setDate(r.getDate()-1);var l=$.datepicker.formatDate("yy-mm-dd",r),n=$.merge(this.getAvailablePartialSlots(l,[{h1:0,m1:0,h2:24-this.tzf(e),m2:0}],t),this.getAvailablePartialSlots(e,[{h1:24-this.tzf(e),m1:0,h2:24,m2:0}],t));i.htmlUsedSlots[e]=$.merge(s(l,24-this.tzf(e),24),s(e,0,24-this.tzf(e)))}else{r.setDate(r.getDate()+1);var l=$.datepicker.formatDate("yy-mm-dd",r),n=$.merge(this.getAvailablePartialSlots(e,[{h1:0,m1:0,h2:-1*this.tzf(e),m2:0}],t),this.getAvailablePartialSlots(l,[{h1:-1*this.tzf(e),m1:0,h2:24,m2:0}],t));i.htmlUsedSlots[e]=$.merge(s(e,-1*this.tzf(e),24),s(l,0,-1*this.tzf(e)))}return i.slotsDate[a]=n,n},getAvailableSlots:function(e){var t=this,i="s"+(t.showAllServices?"":t.service_selected)+"q"+t.quantity_selected+"d"+e;if(0==t.tzf(e)&&void 0!==t.slotsDate[i])return t.slotsDate[i];var a=[];if(t.showAllServices){t.availableSlotsByService[e]=[];for(var s=0;s<t.services.length;s++)t.availableSlotsByService[e][s]=this.getAvailableSlotsByService(e,s),t.availableSlotsByService[e][s].length>a.length&&(a=t.availableSlotsByService[e][s].slice(0))}else a=this.getAvailableSlotsByService(e,t.service_selected);return t.slotsDate[i]=a,a},rC:function(e){var t=this,i=$.datepicker.formatDate("yy-mm-dd",e),a=[i,"d"+i];0==t.working_dates[e.getDay()]&&-1==$.inArray(i,t.special_days)&&a.push("nonworking","ui-datepicker-unselectable","ui-state-disabled");for(var s=0,r=t.invalidDates.length;s<r;s++)e.getTime()===t.invalidDates[s].getTime()&&-1==$.inArray(i,t.special_days)&&a.push("nonworking","ui-datepicker-unselectable","ui-state-disabled","invalidDate");if(""!==t.minDate&&""!=t.getMinDate&&i<$.datepicker.formatDate("yy-mm-dd",t.getMinDate)&&a.push("nonworking","ui-datepicker-unselectable","ui-state-disabled","beforemindate"),""!==t.maxDate&&""!=t.getMaxDate&&i>$.datepicker.formatDate("yy-mm-dd",new Date(t.getMaxDate.getTime()-1))&&a.push("nonworking","ui-datepicker-unselectable","ui-state-disabled","aftermaxdate"),-1==$.inArray("ui-datepicker-unselectable",a)&&!t.emptySelectCheckbox||t.emptySelectCheckbox&&$(".fieldCalendarService"+t.name+" select option:selected").index()>0){var n=t.getAvailableSlots(i);if(0==n.length&&t.notShowBookedDate&&a.push("nonworking","ui-datepicker-unselectable","ui-state-disabled","notavailslot"),"undefined"!=typeof cp_hourbk_cmpublic){var l=0,o=a.join(" "),d=0,c=0;if(t.showAllServices)for(var h=0;h<t.services.length;h++){d=0;for(var f=t.getCurrentSlots(n,i,h),s=0;s<f.length;s++)""!=f[s].html&&(d++,l+=void 0!==f[s].quantity?f[s].quantity:0);c+=t.services[h].capacity*d}else{for(var f=t.getCurrentSlots(n,i,t.service_selected),s=0;s<f.length;s++)""!=f[s].html&&(d++,l+=void 0!==f[s].quantity?f[s].quantity:0);c+=t.services[t.service_selected].capacity*d}-1==o.indexOf("nonworking")&&(o+=" ahb_booked"+Math.floor(10*l/c))}}if(void 0===o)var o=a.join(" ");return[-1==o.indexOf("nonworking"),o]},after_show:function(){function e(){$("#ui-datepicker-div").css("display","none")}setTimeout(e,100);try{$.fn.datepicker.noConflict()}catch(t){}for(var i=this,a=$("#field"+i.form_identifier+"-"+i.index+" .fieldCalendar"+i.name),s=$("#field"+i.form_identifier+"-"+i.index+" .fieldCalendarService"+i.name),r="",n="",l=0;l<i.services.length;l++)n+=(0!=l?";":"")+i.services[l].capacity;if($("#field"+i.form_identifier+"-"+i.index+" #"+i.name+"_capacity").val(n),$("#field"+i.form_identifier+"-"+i.index).parents("form").bind("invalid-form.validate",function(){setTimeout(function(){$("#field"+i.form_identifier+"-"+i.index+" #"+i.name).hasClass("cpefb_error")&&$("#field"+i.form_identifier+"-"+i.index).parents("form").find(".field.cpefb_error").attr("id")==$("#field"+i.form_identifier+"-"+i.index+" #"+i.name).attr("id")&&$("html, body").animate({scrollTop:$("#field"+i.form_identifier+"-"+i.index+" #"+i.name).parents(".dfield").find(".ahbfield_service").offset().top},100)},100)}),a.addClass("notranslate"),i.openhours.length>0){if(!i.openhours[0].name){var o={name:"Default",openhours:i.openhours.slice(0)};i.openhours=[],i.openhours[0]=o}i.allOH=[],i.allOH=i.openhours.slice(0),i.openhours=[]}var d="";if(""!=i.initialapp)try{for(var c=i.initialapp.split(";"),h="",u=0,l=0;l<c.length;l++)if(""!=c[l]){var m=(h=c[l].split(" "))[1].split("/"),p=m[0].split(":"),g=m[1].split(":"),u=1*h[2],b=1*h[3];d=h[0],i.usedSlots[d]=i.usedSlots[d]||[],o={h1:1*p[0],m1:1*p[1],h2:1*g[0],m2:1*g[1],d:d,serviceindex:u,price:parseFloat(i.services[u].price)*parseFloat(b),quantity:b},i.usedSlots[d][i.usedSlots[d].length]=o,i.allUsedSlots[i.allUsedSlots.length]=o}i.initialServiceInd=u}catch(y){}for(var l=0;l<i.services.length;l++)i.services[l].ohindex=i.services[l].ohindex||0;if(0==i.autonum)for(var l=0;l<i.services.length;l++)i.autonum++,i.services[l].idx=i.autonum;function _(e){if(!(!i.emptySelectCheckbox||i.emptySelectCheckbox&&$(".fieldCalendarService"+i.name+" select option:selected").index()>0)){$("#field"+i.form_identifier+"-"+i.index+" .slotsCalendar"+i.name).html("");return}function t(e){i.cacheArr[e],i.duration,i.bduration=i.duration,i.bSlotsCheckbox||(i.bduration=1*i.bSlots);var t=i.getAvailableSlots(e),s=$.datepicker.parseDate("yy-mm-dd",e);i.showAllServices,i.service_selected,i.quantity_selected;var r=$("#field"+i.form_identifier+"-"+i.index+" .slotsCalendar"+i.name),n=0;if(i.notShowBookedDate&&(0==i.maxNumberOfApp||i.allUsedSlots.length<i.maxNumberOfApp)&&0==t.length&&(!i.usedSlots[e]||0==i.usedSlots[e].length||i.service_change)){for(i.service_change=!1;(!X(s)||0==t.length)&&n<400;)n++,s.setDate(s.getDate()+1),t=i.getAvailableSlots($.datepicker.formatDate("yy-mm-dd",s));t.length>0?(a.datepicker("setDate",s),i.getD=s,_($.datepicker.formatDate("yy-mm-dd",s))):(a.datepicker("setDate",i.getMinDate),r.html('<div class="slots">'+cp_hourbk_nomore_label+"</div>"));return}function l(e,t,a){for(var s="",r=i.getCurrentSlots(e,t,a),n=i.services[a].capacity,l=0;l<r.length;l++)"undefined"!=typeof cp_hourbk_cmpublic&&(r[l].html=r[l].html.replace("ahbslotavailabilityP",n),r[l].html=r[l].html.replace("ahbslotavailabilityT",n)),s+=r[l].html;return s}i.service_change=!1;var d="";if(i.showAllServices)for(var n=0;n<i.services.length;n++)""!=(str_s=l(i.availableSlotsByService[e][n],e,n))&&(d+='<div class="service service'+n+'"><div class="service_title">'+i.services[n].name+"</div>"+str_s+"</div>");else d=l(t,e,i.service_selected);""==d&&(d=cp_hourbk_nomore_label);var c="";r.find(".slots").length>0&&(c=r.find(".slots").attr("d")),r.html('<div class="slots" d="'+e+'"><span>'+$.datepicker.formatDate(i.dateFormat,$.datepicker.parseDate("yy-mm-dd",e))+"</span><br />"+d+"</div>"),""!=c&&c!=e&&r.find(".slots span:first").hide().show(200);var h="",u="";i.allUsedSlots=i.allUsedSlots||[],i.allUsedSlots.sort(function(e,t){return $.datepicker.parseDate("yy-mm-dd",e.d).getTime()+(60*e.h1+e.m1)*6e4-($.datepicker.parseDate("yy-mm-dd",t.d).getTime()+(60*t.h1+t.m1)*6e4)}),O=0;for(var m=0,n=0;n<i.allUsedSlots.length;n++)m+=i.allUsedSlots[n].price,h+='<div class="ahb_list" d="'+i.allUsedSlots[n].d+'" quantity="'+i.allUsedSlots[n].quantity+'" s="'+i.allUsedSlots[n].serviceindex+'" h1="'+i.allUsedSlots[n].h1+'" m1="'+i.allUsedSlots[n].m1+'" h2="'+i.allUsedSlots[n].h2+'" m2="'+i.allUsedSlots[n].m2+'" ><span class="ahb_list_time">'+i.formatString(i.allUsedSlots[n],!0,i.tzf(e))+'</span><span class="ahb_list_service">'+i.services[i.allUsedSlots[n].serviceindex].name+'</span><span class="ahb_list_quantity ahb_list_quantity'+i.allUsedSlots[n].quantity+'">('+i.allUsedSlots[n].quantity+')</span><a href="" class="cancel" d="'+e+'" i="'+O+'" iall="'+n+'">['+(cp_hourbk_cancel_label||"cancel")+"]</a>"+("undefined"!=typeof cp_hourbk_repeat?showrepeat(i,n):"")+"</div>",u+=(""==u?"":";")+i.allUsedSlots[n].d+" "+i.formattime(60*i.allUsedSlots[n].h1+1*i.allUsedSlots[n].m1,2)+"/"+i.formattime(60*i.allUsedSlots[n].h2+1*i.allUsedSlots[n].m2,2)+" "+i.allUsedSlots[n].serviceindex+" "+i.allUsedSlots[n].quantity,i.allUsedSlots[n].d==e&&O++;i.sub_cost=m,m=i.sub_cost+i.extras,m*=1+i.percent/100,m=m.toFixed(2),i.showTotalCost&&""!=h&&(h+='<div class="totalCost"><span>'+cp_hourbk_cost_label+'</span><span class="n"> '+i.showTotalCostFormat.replace("{0}",m)+"</span></div>"),$(".usedSlots"+i.name).html(h),$("#field"+i.form_identifier+"-"+i.index+" #"+i.name).val(u),$("#field"+i.form_identifier+"-"+i.index+" #tcost"+i.name).val(m),$("#field"+i.form_identifier+"-"+i.index+" #"+i.name).change();try{$("#fbuilder .slots div a").tooltip({position:{my:"left top+10"},open:function(e,t){$(this).tooltip("option","content",$(this).parent().find(".ahbmoreinfo").html())},tooltipClass:"ahbtooltip"})}catch(p){}$(".slotsCalendar"+i.name+" .slots a").off("click").on("click",function(){var e=parseFloat($(".fieldCalendarService"+i.name+" select.ahbfield_quantity option:selected").val());if(1==i.maxNumberOfApp&&i.allUsedSlots.length==i.maxNumberOfApp||i.allUsedSlots.length>0&&i.allUsedSlots[0].quantity!=e&&!i.allowDifferentQuantities){for(var t=0;t<i.allUsedSlots.length;t++){var a="s"+i.allUsedSlots[t].serviceindex+"q"+i.allUsedSlots[t].quantity+"d"+i.allUsedSlots[t].d,s="sq"+i.allUsedSlots[t].quantity+"d"+i.allUsedSlots[t].d;delete i.slotsDate[a],delete i.slotsDate[s],i.avoidOverlaping&&(i.slotsDate=[]),i.usedSlots[i.allUsedSlots[t].d]=[]}i.allUsedSlots=[]}if($(this).parents("fieldset").hasClass("ahbgutenberg_editor")||($("#field"+i.form_identifier+"-"+i.index+" div.cpefb_error").remove(),$(this).parent().hasClass("htmlUsed")||$(this).parent().hasClass("currentSelection")&&!i.allowSelectSameSlot))return!1;if(i.allUsedSlots=i.allUsedSlots||[],0==i.maxNumberOfApp||i.allUsedSlots.length<i.maxNumberOfApp){var r=$(this).attr("d");i.usedSlots[r]=i.usedSlots[r]||[];var n=1*$(this).attr("s");o={currentSelection:!0,h1:1*$(this).attr("h1"),m1:1*$(this).attr("m1"),h2:1*$(this).attr("h2"),m2:1*$(this).attr("m2"),d:r,serviceindex:n,price:parseFloat(i.services[n].price)*e,quantity:e},i.usedSlots[r][i.usedSlots[r].length]=o,i.allUsedSlots[i.allUsedSlots.length]=o,$(document).trigger("beforeClickSlot",{name:i.name,d:r});var a="s"+n+"q"+e+"d"+r,s="sq"+e+"d"+r;delete i.slotsDate[a],delete i.slotsDate[s],i.avoidOverlaping&&(i.slotsDate=[]),_($.datepicker.formatDate("yy-mm-dd",i.getD))}else alert($.validator.messages.maxapp.replace("{0}",i.maxNumberOfApp));return!1}),$(".usedSlots"+i.name+" a.cancel").off("click").on("click",function(){var e=$(this).parents(".ahb_list").attr("d"),t=$(this).parents(".ahb_list").attr("h1"),s=$(this).parents(".ahb_list").attr("m1"),r=$(this).parents(".ahb_list").attr("h2"),n=$(this).parents(".ahb_list").attr("m2"),l=$(this).parents(".ahb_list").attr("s");i.usedSlots[e]=i.usedSlots[e]||[];for(var o=!1,d=0;d<i.usedSlots[e].length&&!o;d++)i.usedSlots[e][d].d==e&&i.usedSlots[e][d].h1==t&&i.usedSlots[e][d].m1==s&&i.usedSlots[e][d].h2==r&&i.usedSlots[e][d].m2==n&&i.usedSlots[e][d].serviceindex==l&&(o=!0,i.usedSlots[e].splice(d,1));for(var o=!1,d=0;d<i.allUsedSlots.length&&!o;d++)i.allUsedSlots[d].d==e&&i.allUsedSlots[d].h1==t&&i.allUsedSlots[d].m1==s&&i.allUsedSlots[d].h2==r&&i.allUsedSlots[d].m2==n&&i.allUsedSlots[d].serviceindex==l&&(o=!0,i.allUsedSlots.splice(d,1));var c="s"+l+"q"+i.quantity_selected+"d"+e,h="sq"+i.quantity_selected+"d"+e;return delete i.slotsDate[c],delete i.slotsDate[h],i.avoidOverlaping&&(i.slotsDate=[]),a.datepicker("setDate",i.getD),_($.datepicker.formatDate("yy-mm-dd",i.getD)),!1})}t(e),$(document).trigger("afterOnChange",{name:i.name,me:i})}i.initcacheOpenHours(),"undefined"!=typeof cpapphourbk_in_admin&&(i.minDate="",i.maxDate="",i.maxNumberOfApp=0),i.loadOK||(i.formId=$(".fieldCalendarService"+i.name).parents("form").find('input[type="hidden"][name$="cp_appbooking_id"]').val(),$.ajax({dataType:"json",type:"POST",url:document.location.href,cache:!0,data:{cp_app_action:"get_slots",formid:i.formId,initialID:i.initialID,formfield:i.name.replace(i.form_identifier,"")},success:function(e){for(var t=0;t<e.length;t++){var a=e[t].d;if((void 0===e[t].sid||(e[t].serviceindex=i.getServiceInd(e[t].sid),-1!=e[t].serviceindex))&&(-1==e[t].serviceindex&&delete e[t].serviceindex,i.cacheArr[a]=i.cacheArr[a]||[],i.cacheArr[a][i.cacheArr[a].length]=e[t],e[t].h1>e[t].h2&&0!=e[t].h2||e[t].h2>24)){e[t].h1>e[t].h2&&(e[t].h2+=24);var s=jQuery.extend({},e[t]);s.h2=e[t].h2-24,s.h1=0,s.m1=0;var r=$.datepicker.parseDate("yy-mm-dd",a);r.setDate(r.getDate()+1),s.d=$.datepicker.formatDate("yy-mm-dd",r),e[t].h2=24,i.cacheArr[s.d]=i.cacheArr[s.d]||[],i.cacheArr[s.d][i.cacheArr[s.d].length]=s}}i.slotsDate=[],i.loadOK=!0}})),this.invalidDates=this.invalidDates.replace(/\s+/g,"");try{var S="mm/dd/yy";if(-1!=this.invalidDates.indexOf(".")&&(S=i.dateFormat),!/^\s*$/.test(this.invalidDates)){var x=0,D=this.invalidDates.split(",");this.invalidDates=[];for(var l=0,k=D.length;l<k;l++){var C=D[l].split("-");if(2==C.length){for(var w=$.datepicker.parseDate(S,C[0]),q=$.datepicker.parseDate(S,C[1]);w<=q;)if(null!==w){this.invalidDates[x]=w;var A=new Date(w.valueOf());A.setDate(A.getDate()+1),w=A,x++}}else for(var O=0,T=C.length;O<T;O++)null!==$.datepicker.parseDate(S,C[O])&&(this.invalidDates[x]=$.datepicker.parseDate(S,C[O]),x++)}}}catch(U){}$.validator.messages.date_format&&""!=$.validator.messages.date_format&&(i.dateFormat=$.validator.messages.date_format);for(var n=1,l=0;l<i.services.length;l++)r+='<option value="'+i.services[l].duration+'">'+i.services[l].name+"</option>",i.services[l].capacity=parseFloat(i.services[l].capacity)>0?i.services[l].capacity:1,n<i.services[l].capacity&&(n=i.services[l].capacity);i.emptySelectCheckbox&&(r='<option value="">'+i.emptySelect+"</option>"+r);for(var M="",l=1;l<=i.services[0].capacity;l++)M+='<option value="'+l+'">'+l+"</option>";s.html('<select class="ahbfield_service">'+r+'</select><div class="ahbfield_quantity_div" '+(i.showQuantity?"":"style='display:none'")+'><label class="ahbfield_quantity_label">'+("undefined"!=typeof cp_hourbk_quantity_label?cp_hourbk_quantity_label:"Quantity")+'</label><br /><select class="ahbfield_quantity" autocomplete="off">'+M+"</select></div>"),i.service_selected=i.normalizeSelectIndex($(".fieldCalendarService"+i.name+" select.ahbfield_service option:selected").index()),i.quantity_selected=parseFloat($(".fieldCalendarService"+i.name+" select.ahbfield_quantity option:selected").val()),i.duration=parseFloat(i.services[i.service_selected].duration),i.pa=1*i.services[i.service_selected].pa||0,i.pb=1*i.services[i.service_selected].pb||0,$(".fieldCalendarService"+i.name+" select.ahbfield_service").bind("change",function(){i.service_change=!0,i.service_selected=i.normalizeSelectIndex($(".fieldCalendarService"+i.name+" select.ahbfield_service option:selected").index()),i.duration=parseFloat(i.services[i.service_selected].duration),i.pa=1*i.services[i.service_selected].pa||0,i.pb=1*i.services[i.service_selected].pb||0,i.special_days=i.getSpecialDays();for(var e="",t=1;t<=i.services[i.service_selected].capacity;t++)e+='<option value="'+t+'">'+t+"</option>";$(".fieldCalendarService"+i.name+" select.ahbfield_quantity").html(e),i.quantity_selected=parseFloat($(".fieldCalendarService"+i.name+" select.ahbfield_quantity option:selected").val()),void 0!==i.getDMin&&(i.getD=i.getDMin),$("#field"+i.form_identifier+"-"+i.index+" .fieldCalendar"+i.name).datepicker("option","beforeShowDay",function(e){return i.rC(e)}),_($.datepicker.formatDate("yy-mm-dd",i.getD))}),$(".fieldCalendarService"+i.name+" select.ahbfield_quantity").bind("change",function(){if(!i.allowDifferentQuantities){i.quantity_selected=parseFloat($(".fieldCalendarService"+i.name+" select.ahbfield_quantity option:selected").val()),i.allUsedSlots=i.allUsedSlots||[];for(var e=0;e<i.allUsedSlots.length;e++){var t=!1,a=i.allUsedSlots[e],s=i.getAvailableSlotsByService(a.d,a.serviceindex);for(r=0;r<s.length&&!t;r++)60*a.h1+1*a.m1>=s[r].t1&&60*a.h2+1*a.m2<=s[r].t2&&(t=!0);i.usedSlots[a.d]=i.usedSlots[a.d]||[],f=!1;for(var r=0;r<i.usedSlots[a.d].length&&!f;r++)i.usedSlots[a.d][r].h1==a.h1&&i.usedSlots[a.d][r].m1==a.m1&&i.usedSlots[a.d][r].h2==a.h2&&i.usedSlots[a.d][r].m2==a.m2&&i.usedSlots[a.d][r].serviceindex==a.serviceindex&&(f=!0,t?(i.allUsedSlots[e].quantity=i.quantity_selected,i.usedSlots[a.d][r].quantity=i.quantity_selected,i.allUsedSlots[e].price=parseFloat(i.services[a.serviceindex].price)*i.quantity_selected,i.usedSlots[a.d][r].price=i.allUsedSlots[e].price):(i.usedSlots[a.d].splice(r,1),i.allUsedSlots.splice(e,1),e--))}}$("#field"+i.form_identifier+"-"+i.index+" .fieldCalendar"+i.name).datepicker("option","beforeShowDay",function(e){return i.rC(e)}),_($.datepicker.formatDate("yy-mm-dd",i.getD))}),$("#"+i.name).bind("change",function(){"reload"==$(this).attr("reload")&&($(this).attr("reload",""),_($.datepicker.formatDate("yy-mm-dd",i.getD)),$("#field"+i.form_identifier+"-"+i.index+" .fieldCalendar"+i.name).datepicker("option","beforeShowDay",function(e){return i.rC(e)}))});try{i.special_days=i.getSpecialDays()}catch(z){}var H=0,I="",N="";if(i.getMinDate="",""!==i.minDate){if(-1!=i.minDate.indexOf("@")){var P=i.minDate.split("@");i.minDate=P[0],I=P[1]}if(i.minDate.length<6&&-1!=i.minDate.indexOf("h")){if(-1!=i.minDate.indexOf(" "))for(var P=i.minDate.split(" "),E=!1,l=0;l<P.length&&!E;l++)-1!=P[l].indexOf("h")&&(E=!0,H=parseFloat(P[l].replace("h","")),i.minDate=i.minDate.replace(P[l],""));else H=parseFloat(i.minDate.replace("h","")),i.minDate=0}}if(""!==i.maxDate){if(-1!=i.maxDate.indexOf("@")){var P=i.maxDate.split("@");i.maxDate=P[0],N=P[1]}if(i.maxDate.length<6&&-1!=i.maxDate.indexOf("h")){if(i.maxDate=i.maxDate.toLowerCase().replace(/ h/gi,"h"),-1!=i.maxDate.indexOf(" ")){for(var P=i.maxDate.split(" "),E=!1,l=0;l<P.length&&!E;l++)if(-1!=P[l].indexOf("h")){E=!0;var F=parseFloat(P[l].replace("h",""));i.maxDate=i.maxDate.replace(P[l],"")}}else{var F=parseFloat(i.maxDate.replace("h","")),L=F%24;i.maxDate=new Date($.fbuilder.nDate().getTime()+36e5*F),F=L;var R=!0}}}if(a.datepicker({numberOfMonths:parseFloat(i.numberOfMonths),showWeek:i.showWeek,dateFormat:i.dateFormat,changeMonth:i.showDropdown,changeYear:i.showDropdown,yearRange:i.showDropdown?i.dropdownRange:"",onSelect:function(e,t){i.getD=a.datepicker("getDate"),_($.datepicker.formatDate("yy-mm-dd",i.getD)),$("#field"+i.form_identifier+"-"+i.index+" div.cpefb_error").remove()}}),a.datepicker("option",$.datepicker.regional[$.validator.messages.language]),$.datepicker.setDefaults($.datepicker.regional[$.validator.messages.language]),a.datepicker("option","firstDay",i.firstDay),a.datepicker("option","dateFormat",i.dateFormat),a.datepicker("option","minDate",i.minDate),a.datepicker("option","maxDate",i.maxDate),""!==i.minDate){i.getMinDate=a.datepicker("getDate");var B=$.fbuilder.nDate(),V=1;try{$.datepicker.parseDate(i.dateFormat,i.minDate),V=0}catch(Z){}if(i.getMinDate=new Date(i.getMinDate.getTime()+V*B.getHours()*36e5+V*B.getMinutes()*6e4+36e5*H),""!=I){var P=I.split(":");parseFloat(P[0])>=0&&24>parseFloat(P[0])&&parseFloat(P[1])>=0&&60>parseFloat(P[1])&&(i.getMinDate=new Date(i.getMinDate.getFullYear(),i.getMinDate.getMonth(),i.getMinDate.getDate(),parseFloat(P[0]),parseFloat(P[1])))}a.datepicker("option","minDate",i.getMinDate),a.datepicker("setDate",i.getMinDate)}if(""!==i.maxDate)try{i.getMaxDate=$.datepicker._getMinMaxDate(a.data("datepicker"),"max"),i.getMaxDate.setHours(24,0,0,0)}catch(Q){}if(void 0!==F){var B=$.fbuilder.nDate();i.getMaxDate.setHours(B.getHours()-24,B.getMinutes(),B.getSeconds()),i.getMaxDate=new Date(i.getMaxDate.getTime()+36e5*F),R&&(i.getMaxDate=new Date(i.maxDate))}if(""!=N){var P=N.split(":");parseFloat(P[0])>=0&&24>parseFloat(P[0])&&parseFloat(P[1])>=0&&60>parseFloat(P[1])&&(i.getMaxDate=new Date(i.getMaxDate.getFullYear(),i.getMaxDate.getMonth(),i.getMaxDate.getDate(),parseFloat(P[0]),parseFloat(P[1])))}try{""!==i.defaultDate&&a.datepicker("setDate",i.defaultDate)}catch(W){}a.datepicker("option","maxDate",i.maxDate),""!=i.getMaxDate&&0!=i.tzf($.datepicker.formatDate("yy-mm-dd",i.getMaxDate))&&a.datepicker("option","maxDate",new Date(i.getMaxDate.getTime()+36e5*i.tzf($.datepicker.formatDate("yy-mm-dd",i.getMaxDate)))),i.tmpinvalidDatestime=[];try{for(var l=0;l<i.tmpinvalidDates.length;l++)i.tmpinvalidDatestime[l]=i.invalidDates[l].getTime()}catch(K){}function X(e){for(var t=i.services[i.normalizeSelectIndex($(".fieldCalendarService"+i.name+" select option:selected").index())].ohindex,a=0;a<i.allOH[t].openhours.length;a++)if("special"==i.allOH[t].openhours[a].type&&i.allOH[t].openhours[a].d==$.datepicker.formatDate("yy-mm-dd",e))return!0;var s=e.getTime();return!($.inArray(s,i.tmpinvalidDatestime)>-1)&&0!=i.working_dates[e.getDay()]}for(var J=0,l=0;l<i.working_dates.length;l++)J+=i.working_dates[l];for(var Y in i.cacheOpenHours[i.service_selected])J++;if(J>0){for(var G=a.datepicker("getDate"),l=0;!X(G)&&l<400;)G.setDate(G.getDate()+1),l++;function ee(){i.loadOK?($("#field"+i.form_identifier+"-"+i.index+" .fieldCalendar"+i.name).datepicker("option","beforeShowDay",function(e){return i.rC(e)}),_($.datepicker.formatDate("yy-mm-dd",i.getD)),$("#field"+i.form_identifier+"-"+i.index+" .fieldCalendar"+i.name).datepicker("option","beforeShowDay",function(e){return i.rC(e)})):setTimeout(ee,100)}a.datepicker("setDate",G),i.getD=G,ee()}if(preselect_service=function(e){$(".fieldCalendarService"+i.name+" select.ahbfield_service").children().removeAttr("selected"),i.emptySelectCheckbox?$(".fieldCalendarService"+i.name+" select.ahbfield_service").children().eq(e+1).prop("selected","selected").change():$(".fieldCalendarService"+i.name+" select.ahbfield_service").children().eq(e).prop("selected","selected").change(),1==i.maxNumberOfApp&&i.allUsedSlots.length==i.maxNumberOfApp&&$(".fieldCalendarService"+i.name+" select.ahbfield_quantity").val(i.allUsedSlots[0].quantity)},"undefined"!=typeof cp_hourbk_preselect&&void 0!==cp_hourbk_preselect[i.form_identifier]&&""!=cp_hourbk_preselect[i.form_identifier])preselect_service(1*cp_hourbk_preselect[i.form_identifier]);else if(""!=i.initialapp&&""!=d)try{i.getD=$.datepicker.parseDate("yy-mm-dd",d),a.datepicker("setDate",i.getD),preselect_service(i.initialServiceInd),_(d)}catch(ei){}if(getExtrasVisible=function(e){try{for(var t=e.attr("id").split("_"),i=$.fbuilder.forms["_"+t[t.length-1]].getItems(),a=0;a<i.length;a++)"fapp"==i[a].ftype&&($("#"+i[a].name).parent().is(":visible")||$("#"+i[a].name).parents(".fields").hasClass("cp_active"))&&getExtras(i[a],e)}catch(s){}},getExtras=function(e,t){var i=0,a=!1,s=":checked:not(.ignore),[type=text]:not(.ignore)",r=t.find(".ahb_service").find(s);r.length&&(a=!0,r.each(function(){($(this).parents(".fields").hasClass("cp_active")||$(this).is(":visible")||"OPTION"==$(this).prop("tagName")&&$(this).parent().is(":visible"))&&$.isNumeric(this.value)&&(i+=1*this.value)})),e.percent=0;var r=t.find(".ahb_service_percent").find(s);r.length&&(a=!0,r.each(function(){($(this).parents(".fields").hasClass("cp_active")||$(this).is(":visible")||"OPTION"==$(this).prop("tagName")&&$(this).parent().is(":visible"))&&$.isNumeric(this.value)&&(e.percent+=1*this.value)})),r=t.find(".ahb_service_per_slot").find(s),e.allUsedSlots=e.allUsedSlots||[];var n=e.allUsedSlots.length;r.length&&(a=!0,r.each(function(){($(this).parents(".fields").hasClass("cp_active")||$(this).is(":visible")||"OPTION"==$(this).prop("tagName")&&$(this).parent().is(":visible"))&&$.isNumeric(this.value)&&(i+=this.value*n)})),r=t.find(".ahb_service_per_quantity_selection").find(s);var l=t.find(".ahbfield_quantity").val();parseFloat(l)||(l=1),r.length&&(a=!0,r.each(function(){($(this).parents(".fields").hasClass("cp_active")||$(this).is(":visible")||"OPTION"==$(this).prop("tagName")&&$(this).parent().is(":visible"))&&$.isNumeric(this.value)&&(i+=this.value*l)})),t.find("#"+e.name+"_services").val(i),e.extras=i;var o=e.sub_cost+e.extras;o*=1+e.percent/100,o=o.toFixed(2),$("#field"+e.form_identifier+"-"+e.index).find(".totalCost .n").html(" "+e.showTotalCostFormat.replace("{0}",o)),$("#field"+e.form_identifier+"-"+e.index+" #tcost"+e.name).val(o),e.changeAutomatic=!0,$("#field"+e.form_identifier+"-"+e.index+" #"+e.name).change()},$("#field"+i.form_identifier+"-"+i.index).parents("form").find(".ahb_service,.ahb_service_percent,.ahb_service_per_slot,.ahb_service_per_quantity_selection").on("click change keyup",function(){getExtrasVisible($(this).parents("form"))}),$("#field"+i.form_identifier+"-"+i.index+" #"+i.name).change(function(){i.changeAutomatic||getExtrasVisible($(this).parents("form")),i.changeAutomatic=!1}),"undefined"!=typeof cp_hourbk_overlapping_label&&$.extend($.validator.messages,{avoid_overlapping:$.validator.format(cp_hourbk_overlapping_label)}),!("avoid_overlapping"in $.validator.methods)){function ea(e,t){var i=this,a=i.previousValue(t);if(a.old===e)return a.valid;a.old=e,i.startRequest(t);var s=t.id.split("_"),r=s.length>1?"_"+s[1]:"",n=void 0!==$.fbuilder.forms&&void 0!==$.fbuilder.forms[r]?$.fbuilder.forms[r].getItem(s[0]+"_"+s[1]):null;return null==n||($.ajax({dataType:"json",type:"POST",url:document.location.href,data:{cp_app_action:"get_slots",formid:n.formId,initialID:n.initialID,formfield:n.name.replace(n.form_identifier,"")},success:function(e){var s=!1,r=!1;n.ignoreUsedSlots=!0,n.cacheArr=[];for(var l=0;l<e.length;l++){var o=e[l].d;void 0!==e[l].sid&&(e[l].serviceindex=n.getServiceInd(e[l].sid)),n.cacheArr[o]=n.cacheArr[o]||[],n.cacheArr[o][n.cacheArr[o].length]=e[l]}n.slotsDate=[],n.loadOK=!0;for(var d="",l=0;l<n.allUsedSlots.length;l++){n.service_selected=n.allUsedSlots[l].serviceindex,n.quantity_selected=n.allUsedSlots[l].quantity,n.duration=parseFloat(n.services[n.service_selected].duration);var c=n.allUsedSlots[l].d,h=60*n.allUsedSlots[l].h1+n.allUsedSlots[l].m1,u=60*n.allUsedSlots[l].h2+n.allUsedSlots[l].m2;if(0!=n.tzf(c)){var m=$.datepicker.parseDate("yy-mm-dd",c),p=new Date(m.getTime()+6e4*h+36e5*n.tzf(c));c=$.datepicker.formatDate("yy-mm-dd",p)}var g=n.getAvailableSlots(c);n.showAllServices&&(g=n.availableSlotsByService[c][n.service_selected]),r=!1;for(var b=0;b<g.length&&!r;b++)g[b].t1<=h&&g[b].t2>=u&&(r=!0);r||(s=!0,""==d&&(d='<div class="ahb_overlapping_detail"><div class="ahb_overlapping_title">Affected times:</div>'),d+='<div><span class="ahb_list_time">'+n.formatString(n.allUsedSlots[l],!0,n.tzf(c))+'</span><span class="ahb_list_service">'+n.services[n.allUsedSlots[l].serviceindex].name+"</span></div>")}n.ignoreUsedSlots=!1;var y=!s;if(!0===y){var _=i.formSubmitted;i.prepareElement(t),i.formSubmitted=_,i.successList.push(t),delete i.invalid[t.name],i.showErrors()}else{for(var l=0;l<e.length;l++){var o=e[l].d;n.cacheArr[o]=n.cacheArr[o]||[],n.cacheArr[o][n.cacheArr[o].length]=e[l]}n.slotsDate=[],n.loadOK=!0;var S={};""!=d&&(d+="</div>"),S[t.name]=i.defaultMessage(t,"avoid_overlapping")+d,i.invalid[t.name]=!0,i.showErrors(S),t.focus()}a.valid=y,i.stopRequest(t,y),cp_hourbk_avoid_overlapping--}}),"pending")}$.validator.addMethod("avoid_overlapping",ea)}},val:function(){return 0}}),$.fbuilder.controls.facceptance=function(){},$.extend($.fbuilder.controls.facceptance.prototype,$.fbuilder.controls.ffields.prototype,{title:"Accept terms and conditions",ftype:"facceptance",value:"I accept",required:!0,url:"",message:"",show:function(){var e=this,t="",i=e.title;return/^\s*$/.test(e.url)?/^\s*$/.test(e.message)||(i='<a href="javascript:void(0);" class="cff-open-dlg">'+i+"</a>",t+='<div class="cff-dialog hide"><span class="cff-close-dlg"></span><div class="cff-dialog-content">'+e.message+"</div></div>"):i='<a href="'+$.fbuilder.htmlEncode($.trim(e.url))+'" target="_blank">'+i+"</a>",'<div class="fields '+$.fbuilder.htmlEncode(e.csslayout)+' cff-checkbox-field" id="field'+e.form_identifier+"-"+e.index+'"><div class="dfield"><div class="one_column"><label><input name="'+e.name+'" id="'+e.name+'" class="field required" value="'+$.fbuilder.htmlEncode(e.value)+'" vt="'+$.fbuilder.htmlEncode(/^\s*$/.test(e.value)?e.title:e.value)+'" type="checkbox" /> <span>'+$.fbuilder.htmlDecode(i)+(e.required?'<span class="r">*</span>':"")+"</span></label></div>"+t+'</div><div class="clearer"></div></div>'},after_show:function(){$(document).on("click",".cff-open-dlg",function(){var e=$(this).closest(".fields").find(".cff-dialog"),t=e.data("width"),i=e.data("height");e.removeClass("hide"),void 0===t&&(t=Math.min($(this).closest("form").width(),$(window).width(),e.width())),void 0===i&&(i=Math.min($(this).closest("form").height(),$(window).height(),e.height())),e.data("width",t),e.data("height",i),e.css({width:t+"px",height:i+"px","margin-top":-1*i/2+"px","margin-left":-1*t/2+"px"})}),$(document).on("click",".cff-close-dlg",function(){$(this).closest(".cff-dialog").addClass("hide")})},val:function(){var e=$('[id="'+this.name+'"]:checked:not(.ignore)');if(e.length){var t=$.fbuilder.parseValStr(e[0].value);$.isNumeric(t)||(t=t.replace(/^"/,"").replace(/"$/,""))}return v?$.isNumeric(v)?v:'"'+v+'"':0}});for(var fcount=1,fcount_tags=1,fnum="_"+fcount,cp_avoid_hidden=!1;20>fcount||eval("typeof cp_appbooking_fbuilder_config"+fnum+" != 'undefined'");){try{for(var cp_appbooking_fbuilder_config=eval("cp_appbooking_fbuilder_config"+fnum);20>fcount_tags&&!$("#fbuilder_"+fcount_tags).length;)fcount_tags++;(cp_appbooking_fbuilder_config=$.parseJSON(cp_appbooking_fbuilder_config.obj)).identifier="_"+fcount_tags;var opt_identifier=$("#fieldlist_"+fcount_tags);opt_identifier.attr("fcount_tags",fcount_tags),opt_identifier.attr("fnum",fnum),opt_identifier.addClass("cp_avoid_hidden");var f=$("#fbuilder_"+fcount_tags).fbuilder(cp_appbooking_fbuilder_config);f.fBuild.loadData("form_structure_"+fcount_tags),$.fbuilder.configValidate($("#cp_appbooking_pform_"+fcount_tags)),void 0===opt_identifier.attr("fnum")||opt_identifier.is(":hidden")?cp_avoid_hidden=!0:$(opt_identifier).addClass("cp_v_v")}catch(e){}fcount++,fcount_tags++,fnum="_"+fcount}cp_avoid_hidden&&$(document).each(function(){new MutationObserver(function(mutationsList,observer){for(let k in mutationsList){var mutation=mutationsList[k];if("childList"===mutation.type&&mutation.addedNodes.length)try{$(".cp_avoid_hidden").each(function(){var opt_identifier=$("#"+$(this).attr("id"));if(void 0!==opt_identifier.attr("fnum")&&!opt_identifier.is(":hidden")&&!opt_identifier.hasClass("cp_v_v")){$(opt_identifier).addClass("cp_v_v");var f,fnum=opt_identifier.attr("fnum"),fcount_tags=opt_identifier.attr("fcount_tags"),cp_appbooking_fbuilder_config=eval("cp_appbooking_fbuilder_config"+fnum);(cp_appbooking_fbuilder_config=$.parseJSON(cp_appbooking_fbuilder_config.obj)).identifier="_"+fcount_tags,$("#fbuilder_"+fcount_tags).fbuilder(cp_appbooking_fbuilder_config).fBuild.loadData("form_structure_"+fcount_tags),$.fbuilder.configValidate(opt_identifier.closest("form"))}})}catch(err){}}}).observe(this,{childList:!0,subtree:!0})})}(fbuilderjQuery)});